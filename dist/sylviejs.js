var X=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var De=Object.prototype.hasOwnProperty;var d=(a,r)=>X(a,"name",{value:r,configurable:!0}),re=(a=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(a,{get:(r,e)=>(typeof require<"u"?require:r)[e]}):a)(function(a){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+a+'" is not supported')});var Ae=(a,r)=>()=>(a&&(r=a(a=0)),r);var Pe=(a,r)=>{for(var e in r)X(a,e,{get:r[e],enumerable:!0})},ke=(a,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Se(r))!De.call(a,i)&&i!==e&&X(a,i,{get:()=>r[i],enumerable:!(t=Oe(r,i))||t.enumerable});return a};var $e=a=>ke(X({},"__esModule",{value:!0}),a);var pe=(a,r,e)=>{if(!r.has(a))throw TypeError("Cannot "+e)};var K=(a,r,e)=>(pe(a,r,"read from private field"),e?e.call(a):r.get(a)),ye=(a,r,e)=>{if(r.has(a))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(a):r.set(a,e)},ne=(a,r,e,t)=>(pe(a,r,"write to private field"),t?t.call(a,e):r.set(a,e),e);var ge=(a,r,e)=>new Promise((t,i)=>{var n=l=>{try{o(e.next(l))}catch(c){i(c)}},s=l=>{try{o(e.throw(l))}catch(c){i(c)}},o=l=>l.done?t(l.value):Promise.resolve(l.value).then(n,s);o((e=e.apply(a,r)).next())});var je={};var Ee,P,J,Ce=Ae(()=>{Ee=typeof window!="undefined"&&!!window.__loki_idb_debug;Ee&&console.log("DEBUG: Running indexeddb-adapter in DEBUG mode");P=class{constructor(r,e){if(this.app="loki",this.options=e||{},typeof r!="undefined"&&(this.app=r),this.catalog=null,!this.checkAvailability())throw new Error("IndexedDB does not seem to be supported for your environment")}closeDatabase(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)}checkAvailability(){return!!(typeof indexedDB!="undefined"&&indexedDB)}loadDatabase(r,e){let t=this.app,i=this;if(this.catalog===null||this.catalog.db===null){this.catalog=new J(n=>{i.catalog=n,i.loadDatabase(r,e)});return}this.catalog.getAppKey(t,r,({id:n,val:s})=>{if(typeof e=="function"){if(n===0){e(null);return}e(s)}else console.log(s)})}saveDatabase(r,e,t){let i=this.app,n=this;function s(o){o&&o.success===!0?t(null):t(new Error("Error saving database")),n.options.closeAfterSave&&n.closeDatabase()}if(d(s,"saveCallback"),this.catalog===null||this.catalog.db===null){this.catalog=new J(()=>{n.saveDatabase(r,e,s)});return}this.catalog.setAppKey(i,r,e,s)}deleteDatabase(r,e){let t=this.app,i=this;if(this.catalog===null||this.catalog.db===null){this.catalog=new J(n=>{i.catalog=n,i.deleteDatabase(r,e)});return}this.catalog.getAppKey(t,r,n=>{let s=n.id;s!==0?i.catalog.deleteAppKey(s,e):typeof e=="function"&&e({success:!0})})}deleteDatabasePartitions(r){let e=this;this.getDatabaseList(t=>{t.forEach(i=>{i.startsWith(r)&&e.deleteDatabase(i)})})}getDatabaseList(r){let e=this.app,t=this;if(this.catalog===null||this.catalog.db===null){this.catalog=new J(i=>{t.catalog=i,t.getDatabaseList(r)});return}this.catalog.getAppKeys(e,i=>{let n=[];for(let s=0;s<i.length;s++)n.push(i[s].key);typeof r=="function"?r(n):n.forEach(s=>{console.log(s)})})}getCatalogSummary(r){let e=this.app,t=this;if(this.catalog===null||this.catalog.db===null){this.catalog=new J(i=>{t.catalog=i,t.getCatalogSummary(r)});return}this.catalog.getAllKeys(i=>{let n=[],s,o,l,c,h;for(let u=0;u<i.length;u++)s=i[u],l=s.app||"",c=s.key||"",h=s.val||"",o=l.length*2+c.length*2+h.length+1,n.push({app:s.app,key:s.key,size:o});typeof r=="function"?r(n):n.forEach(u=>{console.log(u)})})}};d(P,"IndexedDBAdapter");P.prototype.loadKey=P.prototype.loadDatabase;P.prototype.saveKey=P.prototype.saveDatabase;P.prototype.deleteKey=P.prototype.deleteDatabase;P.prototype.getKeyList=P.prototype.getDatabaseList;J=class{constructor(r){this.db=null,this.initializeLokiCatalog(r)}initializeLokiCatalog(r){let e=indexedDB.open("SylvieCatalog",1),t=this;e.onupgradeneeded=({target:i})=>{let n=i.result;if(n.objectStoreNames.contains("SylvieAKV")&&n.deleteObjectStore("SylvieAKV"),!n.objectStoreNames.contains("SylvieAKV")){let s=n.createObjectStore("SylvieAKV",{keyPath:"id",autoIncrement:!0});s.createIndex("app","app",{unique:!1}),s.createIndex("key","key",{unique:!1}),s.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=({target:i})=>{t.db=i.result,typeof r=="function"&&r(t)},e.onerror=i=>{throw i}}getAppKey(r,e,t){let s=this.db.transaction(["SylvieAKV"],"readonly").objectStore("SylvieAKV").index("appkey"),o=`${r},${e}`,l=s.get(o);l.onsuccess=(c=>({target:h})=>{let u=h.result;(u===null||typeof u=="undefined")&&(u={id:0,success:!1}),typeof c=="function"?c(u):console.log(u)})(t),l.onerror=(c=>h=>{if(typeof c=="function")c({id:0,success:!1});else throw h})(t)}getAppKeyById(r,e,t){let s=this.db.transaction(["SylvieAKV"],"readonly").objectStore("SylvieAKV").get(r);s.onsuccess=((o,l)=>({target:c})=>{typeof l=="function"?l(c.result,o):console.log(c.result)})(t,e)}setAppKey(r,e,t,i){let s=this.db.transaction(["SylvieAKV"],"readwrite").objectStore("SylvieAKV"),o=s.index("appkey"),l=`${r},${e}`,c=o.get(l);c.onsuccess=({target:h})=>{let u=h.result;u==null?u={app:r,key:e,appkey:`${r},${e}`,val:t}:u.val=t;let p=s.put(u);p.onerror=(f=>g=>{typeof f=="function"?f({success:!1}):(console.error("SylvieCatalog.setAppKey (set) onerror"),console.error(c.error))})(i),p.onsuccess=(f=>g=>{typeof f=="function"&&f({success:!0})})(i)},c.onerror=(h=>u=>{typeof h=="function"?h({success:!1}):(console.error("SylvieCatalog.setAppKey (get) onerror"),console.error(c.error))})(i)}deleteAppKey(r,e){let n=this.db.transaction(["SylvieAKV"],"readwrite").objectStore("SylvieAKV").delete(r);n.onsuccess=(s=>o=>{typeof s=="function"&&s({success:!0})})(e),n.onerror=(s=>o=>{typeof s=="function"?s({success:!1}):(console.error("SylvieCatalog.deleteAppKey raised onerror"),console.error(n.error))})(e)}getAppKeys(r,e){let n=this.db.transaction(["SylvieAKV"],"readonly").objectStore("SylvieAKV").index("app"),s=IDBKeyRange.only(r),o=n.openCursor(s),l=[];o.onsuccess=((c,h)=>({target:u})=>{let p=u.result;if(p){let f=p.value;c.push(f),p.continue()}else typeof h=="function"?h(c):console.log(c)})(l,e),o.onerror=(c=>h=>{typeof c=="function"?c(null):(console.error("SylvieCatalog.getAppKeys raised onerror"),console.error(h))})(e)}getAllKeys(r){let i=this.db.transaction(["SylvieAKV"],"readonly").objectStore("SylvieAKV").openCursor(),n=[];i.onsuccess=((s,o)=>({target:l})=>{let c=l.result;if(c){let h=c.value;s.push(h),c.continue()}else typeof o=="function"?o(s):console.log(s)})(n,r),i.onerror=(s=>o=>{typeof s=="function"&&s(null)})(r)}};d(J,"SylvieCatalog");typeof window!="undefined"&&Object.assign(window,{IndexedDBAdapter:P})});var U=class{constructor(){try{this.fs=re("fs")}catch(r){this.fs=null}}exportDatabase(r,e,t){throw new Error("Method not implemented.")}loadDatabase(r,e){let t=this;this.fs.stat(r,(i,n)=>{!i&&n.isFile()?t.fs.readFile(r,{encoding:"utf8"},d(function(o,l){e(o?new Error(o):l)},"readFileCallback")):e(null)})}saveDatabase(r,e,t){let i=this,n=`${r}~`;this.fs.writeFile(n,e,d(function(o){o?t(new Error(o)):i.fs.rename(n,r,t)},"writeFileCallback"))}deleteDatabase(r,e){this.fs.unlink(r,d(function(i){i?e(new Error(i)):e()},"deleteDatabaseCallback"))}};d(U,"FsAdapter");function q(a,r,e){if(e===!1)return a[r];let t=r.split("."),i=a;for(;t.length>0;)i=i[t.shift()];return i}d(q,"deepProperty");function me(a,r){if(r=="parse-stringify")return I(a,r);for(var e=[],t=0,i=a.length;t<i;t++)e[t]=I(a[t],r);return e}d(me,"cloneObjectArray");function I(a,r){if(a==null)return null;var e=r||"parse-stringify",t;switch(e){case"parse-stringify":t=JSON.parse(JSON.stringify(a));break;case"shallow":t=Object.create(a.constructor.prototype),Object.keys(a).map(function(n){t[n]=a[n]});break;case"shallow-assign":t=Object.create(a.constructor.prototype),Object.assign(t,a);break;case"shallow-recurse-objects":t=I(a,"shallow");var i=Object.keys(a);i.forEach(function(n){typeof a[n]=="object"&&a[n].constructor.name==="Object"?t[n]=I(a[n],"shallow-recurse-objects"):Array.isArray(a[n])&&(t[n]=me(a[n],"shallow-recurse-objects"))});break;default:break}return t}d(I,"clone");function N(a){Object.isFrozen(a)||Object.freeze(a)}d(N,"freeze");function C(a){var r,e;if(Array.isArray(a)){for(e=0;e<a.length;e++)C(a[e]);N(a)}else if(a!==null&&typeof a=="object"){for(r in a)Object.hasOwn(a,r)&&C(a[r]);N(a)}}d(C,"deepFreeze");function B(a){return Object.isFrozen(a)?I(a,"shallow"):a}d(B,"unFreeze");var m={};Pe(m,{copyProperties:()=>ze,getIn:()=>Me,resolveTransformObject:()=>be,resolveTransformParams:()=>Re});var ze=d(function(a,r){var e;for(e in a)r[e]=a[e]},"copyProperties"),be=d(function(a,r,e){var t,i;if(typeof e!="number"&&(e=0),++e>=10)return a;for(t in a)typeof a[t]=="string"&&a[t].indexOf("[%lktxp]")===0?(i=a[t].substring(8),Object.hasOwn(r,i)&&(a[t]=r[i])):typeof a[t]=="object"&&(a[t]=m.resolveTransformObject(a[t],r,e));return a},"resolveTransformObject"),Re=d(function(a,r){var e,t,i=[];if(typeof r=="undefined")return a;for(e=0;e<a.length;e++)t=I(a[e],"shallow-recurse-objects"),i.push(be(t,r));return i},"resolveTransformParams"),Me=d(function(a,r,e){if(a!=null){if(!e)return a[r];if(typeof r=="string"&&(r=r.split(".")),!Array.isArray(r))throw new Error("path must be a string or array. Found "+typeof r);for(var t=0,i=r.length;a!=null&&t<i;)a=a[r[t++]];return t&&t==i?a:void 0}},"getIn");function ee(a){return a.indexOf(".")!==-1}d(ee,"isDeepProperty");function Fe(a,r){return a+r}d(Fe,"add");function ve(a,r){return a-r}d(ve,"sub");function Z(a){return a.reduce(Fe,0)/a.length}d(Z,"average");function we(a){let r=Z(a),e=a.map(function(n){let s=n-r;return s*s}),t=Z(e);return Math.sqrt(t)}d(we,"standardDeviation");function se(a){return typeof a=="string"||Array.isArray(a)?function(r){return a.indexOf(r)!==-1}:typeof a=="object"&&a!==null?function(r){return Object.hasOwn(a,r)}:null}d(se,"containsCheckFn");function W(a,r,e,t,i,n){let s=n||0,o=r[s],l=!1,c;if(a!==null&&typeof a=="object"&&o in a&&(c=a[o]),s+1>=r.length)l=e(c,t,i);else if(Array.isArray(c))for(let h=0,u=c.length;h<u&&(l=W(c[h],r,e,t,i,s+1),l!==!0);h+=1);else l=W(c,r,e,t,i,s+1);return l}d(W,"dotSubScan");var b={aeq:ae,lt:oe,gt:le};function ae(a,r){var e,t,i,n;if(a===r)return!0;if(!a||!r||a===!0||r===!0||a!==a||r!==r){switch(a){case void 0:i=1;break;case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=a===a?9:0;break}switch(r){case void 0:n=1;break;case null:n=1;break;case!1:n=3;break;case!0:n=4;break;case"":n=5;break;default:n=r===r?9:0;break}if(i!==9||n!==9)return i===n}return e=Number(a),t=Number(r),e===e||t===t?e===t:(e=a.toString(),t=r.toString(),e==t)}d(ae,"aeqHelper");function oe(a,r,e){var t,i,n,s;if(!a||!r||a===!0||r===!0||a!==a||r!==r){switch(a){case void 0:n=1;break;case null:n=1;break;case!1:n=3;break;case!0:n=4;break;case"":n=5;break;default:n=a===a?9:0;break}switch(r){case void 0:s=1;break;case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=r===r?9:0;break}if(n!==9||s!==9)return n===s?e:n<s}return t=Number(a),i=Number(r),t===t&&i===i?t<i?!0:t>i?!1:e:t===t&&i!==i?!0:i===i&&t!==t?!1:a<r?!0:a>r?!1:a==r?e:(t=a.toString(),i=r.toString(),t<i?!0:t==i?e:!1)}d(oe,"ltHelper");function le(a,r,e){var t,i,n,s;if(!a||!r||a===!0||r===!0||a!==a||r!==r){switch(a){case void 0:n=1;break;case null:n=1;break;case!1:n=3;break;case!0:n=4;break;case"":n=5;break;default:n=a===a?9:0;break}switch(r){case void 0:s=1;break;case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=r===r?9:0;break}if(n!==9||s!==9)return n===s?e:n>s}return t=Number(a),i=Number(r),t===t&&i===i?t>i?!0:t<i?!1:e:t===t&&i!==i?!1:i===i&&t!==t||a>r?!0:a<r?!1:a==r?e:(t=a.toString(),i=r.toString(),t>i?!0:t==i?e:!1)}d(le,"gtHelper");function ce(a,r,e){return b.aeq(a,r)?0:b.lt(a,r,!1)?e?1:-1:b.gt(a,r,!1)?e?-1:1:0}d(ce,"sortHelper");function Ie(a,r,e){for(var t=0,i,n,s,o,l,c=0,h=a.length;c<h;c++)if(i=a[c],n=i[0],~n.indexOf(".")?(l=n.split("."),s=m.getIn(r,l,!0),o=m.getIn(e,l,!0)):(s=r[n],o=e[n]),t=ce(s,o,i[1]),t!==0)return t;return 0}d(Ie,"compoundeval");function L(a,r,e){for(var t in r)if(Object.hasOwn(r,t))return S[t](a,r[t],e);return!1}d(L,"doQueryOp");var S={$eq:function(a,r){return a===r},$aeq:function(a,r){return a==r},$ne:function(a,r){return r!==r?a===a:a!==r},$dteq:function(a,r){return b.aeq(a,r)},$gt:function(a,r){return b.gt(a,r,!1)},$gte:function(a,r){return b.gt(a,r,!0)},$lt:function(a,r){return b.lt(a,r,!1)},$lte:function(a,r){return b.lt(a,r,!0)},$jgt:function(a,r){return a>r},$jgte:function(a,r){return a>=r},$jlt:function(a,r){return a<r},$jlte:function(a,r){return a<=r},$between:function(a,r){return a==null?!1:b.gt(a,r[0],!0)&&b.lt(a,r[1],!0)},$jbetween:function(a,r){return a==null?!1:a>=r[0]&&a<=r[1]},$in:function(a,r){return r.indexOf(a)!==-1},$inSet:function(a,r){return r.has(a)},$nin:function(a,r){return r.indexOf(a)===-1},$keyin:function(a,r){return a in r},$nkeyin:function(a,r){return!(a in r)},$definedin:function(a,r){return r[a]!==void 0},$undefinedin:function(a,r){return r[a]===void 0},$regex:function(a,r){return r.test(a)},$containsString:function(a,r){return typeof a=="string"&&a.indexOf(r)!==-1},$containsNone:function(a,r){return!S.$containsAny(a,r)},$containsAny:function(a,r){var e=se(a);return e!==null?Array.isArray(r)?r.some(e):e(r):!1},$contains:function(a,r){var e=se(a);return e!==null?Array.isArray(r)?r.every(e):e(r):!1},$elemMatch:function(a,r){return Array.isArray(a)?a.some(function(e){return Object.keys(r).every(function(t){var i=r[t];return typeof i=="object"&&i||(i={$eq:i}),t.indexOf(".")!==-1?W(e,t.split("."),L,r[t],e):L(e[t],i,e)})}):!1},$type:function(a,r,e){var t=typeof a;return t==="object"&&(Array.isArray(a)?t="array":a instanceof Date&&(t="date")),typeof r!="object"?t===r:L(t,r,e)},$finite:function(a,r){return r===isFinite(a)},$size:function(a,r,e){return Array.isArray(a)?typeof r!="object"?a.length===r:L(a.length,r,e):!1},$len:function(a,r,e){return typeof a=="string"?typeof r!="object"?a.length===r:L(a.length,r,e):!1},$where:function(a,r){return r(a)===!0},$not:function(a,r,e){return!L(a,r,e)},$and:function(a,r,e){for(var t=0,i=r.length;t<i;t+=1)if(!L(a,r[t],e))return!1;return!0},$or:function(a,r,e){for(var t=0,i=r.length;t<i;t+=1)if(L(a,r[t],e))return!0;return!1},$exists:function(a,r){return r?a!==void 0:a===void 0}},Te=["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"];Te.forEach(function(a){var r=S[a];S["$"+a]=function(e,t,i){if(typeof t=="string")return r(e,i[t]);if(typeof t=="function")return r(e,t(i));throw new Error("Invalid argument to $$ matcher")}});var te={$eq:S.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function he(a,r){if(a==="$regex")Array.isArray(r)?r=new RegExp(r[0],r[1]):r instanceof RegExp||(r=new RegExp(r));else if(typeof r=="object")for(let e in r)(e==="$regex"||typeof r[e]=="object")&&(r[e]=he(e,r[e]));return r}d(he,"precompileQuery");var x=class{constructor(r,e){this.branch=x.prototype.copy;this.$or=x.prototype.findOr;this.$and=x.prototype.findAnd;return this.options=e||{},this.collection=r,this.filteredrows=[],this.filterInitialized=!1,this}reset(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this}toJSON(){let r=this.copy();return r.collection=null,r}limit(r){!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());let e=new x(this.collection);return e.filteredrows=this.filteredrows.slice(0,r),e.filterInitialized=!0,e}offset(r){!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());let e=new x(this.collection);return e.filteredrows=this.filteredrows.slice(r),e.filterInitialized=!0,e}copy(){let r=new x(this.collection);return this.filteredrows.length>0&&(r.filteredrows=this.filteredrows.slice()),r.filterInitialized=this.filterInitialized,r}transform(r,e){let t,i,n=this;if(typeof r=="string"&&Object.hasOwn(this.collection.transforms,r)&&(r=this.collection.transforms[r]),typeof r!="object"||!Array.isArray(r))throw new Error("Invalid transform");for(typeof e!="undefined"&&(r=m.resolveTransformParams(r,e)),t=0;t<r.length;t++)switch(i=r[t],i.type){case"find":n.find(i.value);break;case"where":n.where(i.value);break;case"simplesort":n.simplesort(i.property,i.desc||i.options);break;case"compoundsort":n.compoundsort(i.value);break;case"sort":n.sort(i.value);break;case"limit":n=n.limit(i.value);break;case"offset":n=n.offset(i.value);break;case"map":n=n.map(i.value,i.dataOptions);break;case"eqJoin":n=n.eqJoin(i.joinData,i.leftJoinKey,i.rightJoinKey,i.mapFun,i.dataOptions);break;case"mapReduce":n=n.mapReduce(i.mapFunction,i.reduceFunction);break;case"update":n.update(i.value);break;case"remove":n.remove();break;default:break}return n}sort(r){!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());let e=((t,i)=>(n,s)=>t(i[n],i[s]))(r,this.collection.data);return this.filteredrows.sort(e),this}simplesort(r,e){let t,i=10,n=this.collection.data.length,s=this.filteredrows.length,o=Object.hasOwn(this.collection.binaryIndices,r);if((typeof e=="undefined"||e===!1)&&(e={desc:!1}),e===!0&&(e={desc:!0}),s===0){if(this.filterInitialized)return this;if(Object.hasOwn(this.collection.binaryIndices,r))return this.collection.ensureIndex(r),this.filteredrows=this.collection.binaryIndices[r].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&o&&(t=n/s,e.useJavascriptSorting&&(i=6),t<=i||e.forceIndexIntersect)){let c,h=this.filteredrows,u={};for(c=0;c<s;c++)u[h[c]]=!0;let p=this.collection.binaryIndices[r].values;return this.filteredrows=p.filter(f=>u[f]),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort((c,h)=>{if(c[r]===h[r])return 0;if(c[r]>h[r])return 1;if(c[r]<h[r])return-1});let l=((c,h,u)=>{let p,f,g;return(y,O)=>(~c.indexOf(".")?(g=c.split("."),p=m.getIn(u[y],g,!0),f=m.getIn(u[O],g,!0)):(p=u[y][c],f=u[O][c]),ce(p,f,h))})(r,e.desc,this.collection.data);return this.filteredrows.sort(l),this}compoundsort(r){if(r.length===0)throw new Error("Invalid call to compoundsort, need at least one property");let e;if(r.length===1)return e=r[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(let i=0,n=r.length;i<n;i+=1)e=r[i],Array.isArray(e)||(r[i]=[e,!1]);!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());let t=((i,n)=>(s,o)=>Ie(i,n[s],n[o]))(r,this.collection.data);return this.filteredrows.sort(t),this}findOr(r){let e=null,t=0,i=0,n=[],s=[],o=0;for(let l=0,c=r.length;l<c;l++)for(e=this.branch().find(r[l]).filteredrows,i=e.length,t=0;t<i;t++)o=e[t],s[o]===void 0&&(s[o]=!0,n.push(o));return this.filteredrows=n,this.filterInitialized=!0,this}findAnd(r){for(let e=0,t=r.length;e<t;e++){if(this.count()===0)return this;this.find(r[e])}return this}find(r,e){if(this.collection.data.length===0)return this.filteredrows=[],this.filterInitialized=!0,this;let t=r||"getAll",i,n,s,o,l,c,h,u=!1,p=[],f=[],g=null;if(e=e||!1,typeof t=="object"){for(i in t)o={},o[i]=t[i],f.push(o),F.call(t,i)&&(n=i,s=t[i]);if(f.length>1)return this.find({$and:f},e)}if(!n||t==="getAll")return e&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0)),this;if(n==="$and"||n==="$or")return this[n](s),e&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(s===null||typeof s!="object"||s instanceof Date)l="$eq",c=s;else if(typeof s=="object"){for(h in s)if(h in s){l=h,c=s[h];break}}else throw new Error("Do not know what you want to do.");(l==="$regex"||typeof c=="object")&&(c=he(l,c));let y=n.includes(".");!this.filterInitialized&&this.collection.binaryIndices[n]&&te[l]&&(this.collection.adaptiveBinaryIndices!==!0&&this.collection.ensureIndex(n),u=!0,g=this.collection.binaryIndices[n]),!u&&l==="$in"&&Array.isArray(c)&&typeof Set!="undefined"&&(c=new Set(c),l="$inSet");let k=S[l];if(typeof k!="function")throw new TypeError('"'+l+'" is not a valid operator');let R=this.collection.data,w=0,$=0,M,G=0,D;if(this.filterInitialized){if(M=this.filteredrows,$=M.length,y){let j=n.split(".");for(w=0;w<$;w++)if(G=M[w],D=R[G],W(D,j,k,c,D)&&(p.push(G),e))return this.filteredrows=p,this}else for(w=0;w<$;w++)if(G=M[w],D=R[G],k(D[n],c,D)&&(p.push(G),e))return this.filteredrows=p,this}else if(u){let j=this.collection.calculateRange(l,n,c);if(l!=="$in"){for(w=j[0];w<=j[1];w++)if(te[l]!==!0){if(te[l](m.getIn(R[g.values[w]],n,y),c)&&(p.push(g.values[w]),e))return this.filteredrows=p,this.filterInitialized=!0,this}else if(p.push(g.values[w]),e)return this.filteredrows=p,this.filterInitialized=!0,this}else for(w=0,$=j.length;w<$;w++)if(p.push(g.values[j[w]]),e)return this.filteredrows=p,this.filterInitialized=!0,this}else if($=R.length,y){let j=n.split(".");for(w=0;w<$;w++)if(D=R[w],W(D,j,k,c,D)&&(p.push(w),e))return this.filteredrows=p,this.filterInitialized=!0,this}else for(w=0;w<$;w++)if(D=R[w],k(D[n],c,D)&&(p.push(w),e))return this.filteredrows=p,this.filterInitialized=!0,this;return this.filteredrows=p,this.filterInitialized=!0,this}where(r){let e,t=[];if(typeof r=="function")e=r;else throw new TypeError("Argument is not a stored view or a function");if(this.filterInitialized){let i=this.filteredrows.length;for(;i--;)e(this.collection.data[this.filteredrows[i]])===!0&&t.push(this.filteredrows[i]);return this.filteredrows=t,this}else{let i=this.collection.data.length;for(;i--;)e(this.collection.data[i])===!0&&t.push(i);return this.filteredrows=t,this.filterInitialized=!0,this}}count(){return this.filterInitialized?this.filteredrows.length:this.collection.count()}update(r){if(typeof r!="function")throw new TypeError("Argument is not a function");!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex());let e,t=this.filteredrows.length,i=this.collection.data;for(let n=0;n<t;n++)!this.collection.disableFreeze||this.collection.cloneObjects||!this.collection.disableDeltaChangesApi?(e=I(i[this.filteredrows[n]],this.collection.cloneMethod),r(e),this.collection.update(e)):(r(i[this.filteredrows[n]]),this.collection.update(i[this.filteredrows[n]]));return this}remove(){return!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this}mapReduce(r,e){return e(this.data().map(r))}eqJoin(r,e,t,i,n){let s=[],o=[],l,c=[],h=typeof e=="function",u=typeof t=="function",p={};s=this.data(n);let f=s.length;if(r instanceof A)o=r.chain().data(n);else if(r instanceof x){let y=new x(new A(""));y.rightData=r.data(n)}else if(Array.isArray(r))o=r;else throw new TypeError("joinData needs to be an array or result set");let g=o.length;for(let y=0;y<g;y++)l=u?t(o[y]):o[y][t],p[l]=o[y];i||(i=d((y,O)=>({left:y,right:O}),"mapFun"));for(let y=0;y<f;y++)l=h?e(s[y]):s[y][e],c.push(i(s[y],p[l]||{}));return this.collection=new A("joinData"),this.collection.insert(c),this.filteredrows=[],this.filterInitialized=!1,this}data(r){var e=[],t=this.collection.data,i,n,s,o;if(r=r||{},r.removeMeta&&!r.forceClones&&(r.forceClones=!0,r.forceCloneMethod=r.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(r.forceClones=!0,r.forceCloneMethod="parse-stringify"),!this.filterInitialized)if(this.filteredrows.length===0)if(this.collection.cloneObjects||r.forceClones){for(n=t.length,o=r.forceCloneMethod||this.collection.cloneMethod,s=0;s<n;s++)i=I(t[s],o),r.removeMeta&&(delete i.$loki,delete i.meta),e.push(i);return e}else return t.slice();else this.filterInitialized=!0;var l=this.filteredrows;if(n=l.length,this.collection.cloneObjects||r.forceClones)for(o=r.forceCloneMethod||this.collection.cloneMethod,s=0;s<n;s++)i=I(t[l[s]],o),r.removeMeta&&(delete i.$loki,delete i.meta),e.push(i);else for(s=0;s<n;s++)e.push(t[l[s]]);return e}map(r,e){let t=this.data(e).map(r);return this.collection=new A("mappedData"),this.collection.insert(t),this.filteredrows=[],this.filterInitialized=!1,this}};d(x,"ResultSet");var T=class{constructor(){this.addListener=this.on;this.events={};this.asyncListeners=!1}on(r,e){let t;var i=this;return Array.isArray(r)?(r.forEach(n=>{this.on(n,e)}),e):(t=this.events[r],t||(t=this.events[r]=[]),t.push(e),e)}emit(r,e,t){let i;var n=this;if(r&&this.events[r])this.events[r].length&&(i=Array.prototype.slice.call(arguments,1),this.events[r].forEach(s=>{this.asyncListeners?setTimeout(()=>{s.apply(n,i)},1):s.apply(n,i)}));else throw new Error(`No event ${r} defined`)}removeListener(r,e){if(Array.isArray(r)){r.forEach(t=>{this.removeListener(t,e)});return}if(this.events[r]){let t=this.events[r];t.splice(t.indexOf(e),1)}}};d(T,"SylvieEventEmitter");var E=class extends T{constructor(e,t,i){super();this.collection=e,this.name=t,this.rebuildPending=!1,this.options=i||{},Object.hasOwn(this.options,"persistent")||(this.options.persistent=!1),Object.hasOwn(this.options,"sortPriority")||(this.options.sortPriority="passive"),Object.hasOwn(this.options,"minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new x(e),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}getSort(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple}rematerialize(e){let t,i,n;e=e||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new x(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);let s=Object.isFrozen(this.filterPipeline);if(Object.hasOwn(e,"removeWhereFilters"))for(s&&(this.filterPipeline=this.filterPipeline.slice()),t=this.filterPipeline.length,i=t;i--;)this.filterPipeline[i].type==="where"&&(i!==this.filterPipeline.length-1&&(this.filterPipeline[i]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);let o=this.filterPipeline;for(this.filterPipeline=[],t=o.length,n=0;n<t;n++)this.applyFind(o[n].val,o[n].uid);return s&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this}branchResultset(e,t){let i=this.resultset.branch();return typeof e=="undefined"?i:i.transform(e,t)}toJSON(){let e=new E(this.collection,this.name,this.options);return e.resultset=this.resultset,e.resultdata=[],e.resultsdirty=!0,e.filterPipeline=this.filterPipeline,e.sortFunction=this.sortFunction,e.sortCriteria=this.sortCriteria,e.sortCriteriaSimple=this.sortCriteriaSimple||null,e.sortDirty=this.sortDirty,e.collection=null,e}removeFilters(e={}){this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;let t=Object.isFrozen(this.filterPipeline),i=this.filterPipeline.length>0;this.filterPipeline=[],t&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,e.queueSortPhase===!0&&this.queueSortPhase(),i&&this.emit("filter")}applySort(e){return this.sortFunction=e,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this}applySimpleSort(e,t){return this.sortCriteriaSimple={propname:e,options:t||!1},this.collection.disableFreeze||C(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this}applySortCriteria(e){return this.sortCriteria=e,this.collection.disableFreeze||C(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this}startTransaction(){return this.cachedresultset=this.resultset.copy(),this}commit(){return this.cachedresultset=null,this}rollback(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this}_indexOfFilterWithId(e){if(typeof e=="string"||typeof e=="number"){for(let t=0,i=this.filterPipeline.length;t<i;t+=1)if(e===this.filterPipeline[t].uid)return t}return-1}_addFilter(e){let t=Object.isFrozen(this.filterPipeline);t&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||C(e),this.filterPipeline.push(e),t&&Object.freeze(this.filterPipeline),this.resultset[e.type](e.val)}reapplyFilters(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);let e=this.filterPipeline,t=Object.isFrozen(e);this.filterPipeline=[];for(let i=0,n=e.length;i<n;i+=1)this._addFilter(e[i]);return t&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this}applyFilter(e){let t=this._indexOfFilterWithId(e.uid);if(t>=0){let i=Object.isFrozen(this.filterPipeline);return i&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[t]=e,i&&(N(e),Object.freeze(this.filterPipeline)),this.reapplyFilters()}return this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(e),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this}applyFind(e,t){return this.applyFilter({type:"find",val:e,uid:t}),this}applyWhere(e,t){return this.applyFilter({type:"where",val:e,uid:t}),this}removeFilter(e){let t=this._indexOfFilterWithId(e);if(t<0)throw new Error(`Dynamic view does not contain a filter with ID: ${e}`);let i=Object.isFrozen(this.filterPipeline);return i&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(t,1),i&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this}count(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()}data(e){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(e)}queueRebuildEvent(){if(this.rebuildPending)return;this.rebuildPending=!0;let e=this;setTimeout(()=>{e.rebuildPending&&(e.rebuildPending=!1,e.emit("rebuild",e))},this.options.minRebuildInterval)}queueSortPhase(){if(this.sortDirty)return;this.sortDirty=!0;let e=this;this.options.sortPriority==="active"?setTimeout(()=>{e.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}performSortPhase(e){!this.sortDirty&&!this.resultsdirty||(e=e||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),e.suppressRebuildEvent||this.emit("rebuild",this))}evaluateDocument(e,t){if(!this.resultset.filterInitialized){this.options.persistent&&(this.resultdata=this.resultset.data()),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}let i=this.resultset.filteredrows,n=t?-1:i.indexOf(+e),s=i.length,o=new x(this.collection);o.filteredrows=[e],o.filterInitialized=!0;let l;for(let h=0,u=this.filterPipeline.length;h<u;h++)l=this.filterPipeline[h],o[l.type](l.val);let c=o.filteredrows.length===0?-1:0;if(!(n===-1&&c===-1)){if(n===-1&&c!==-1){i.push(e),this.options.persistent&&this.resultdata.push(this.collection.data[e]),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}if(n!==-1&&c===-1){n<s-1?(i.splice(n,1),this.options.persistent&&this.resultdata.splice(n,1)):(i.length=s-1,this.options.persistent&&(this.resultdata.length=s-1)),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}if(n!==-1&&c!==-1){this.options.persistent&&(this.resultdata[n]=this.collection.data[e]),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}}}removeDocument(e){let t,i,n={},s={},o=[],l=this.resultset,c=this.resultset.filteredrows,h=c.length;if(!this.resultset.filterInitialized){this.options.persistent&&(this.resultdata=this.resultset.data()),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent();return}Array.isArray(e)||(e=[e]);let u=e.length;for(i=0;i<u;i++)n[e[i]]=!0;for(t=0;t<h;t++)n[c[t]]&&(s[t]=!0);Object.keys(s).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter((f,g)=>!s[g]),this.options.persistent&&(this.resultdata=this.resultdata.filter((f,g)=>!s[g])),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());let p=d(f=>g=>g<l.filteredrows[f],"filt");for(h=l.filteredrows.length,t=0;t<h;t++)o=e.filter(p(t)),l.filteredrows[t]-=o.length}mapReduce(e,t){return t(this.data().map(e))}};d(E,"DynamicView");var z,Y=class{constructor(r){ye(this,z,void 0);ne(this,z,Object.create(null)),this.field=r}set(r,e){K(this,z)[r]?K(this,z)[r].push(e):K(this,z)[r]=[e]}remove(r,e){let t=K(this,z)[r];for(let i in t)t[i]===e&&t.splice(parseInt(i),1);t.length<1&&(K(this,z)[r]=void 0)}get(r){return K(this,z)[r]}clear(){ne(this,z,{})}};d(Y,"ExactIndex"),z=new WeakMap;var H=class{constructor(r){this.field=r,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}set(r){let e=r[this.field];if(e!==null&&typeof e!="undefined"){if(this.keyMap[e])throw new Error(`Duplicate key for property ${this.field}: ${e}`);this.keyMap[e]=r,this.lokiMap[r.$loki]=e}}get(r){return this.keyMap[r]}byId(r){return this.keyMap[this.lokiMap[r]]}update(r,e){if(this.lokiMap[r.$loki]!==e[this.field]){let t=this.lokiMap[r.$loki];this.set(e),this.keyMap[t]=void 0}else this.keyMap[r[this.field]]=e}remove(r){let e=this.keyMap[r];if(e!==null&&typeof e!="undefined")this.keyMap[r]=void 0,this.lokiMap[e.$loki]=void 0;else throw new Error(`Key is not in unique index: ${this.field}`)}clear(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}};d(H,"UniqueIndex");H.prototype.keyMap={};H.prototype.lokiMap={};function xe(a){return parseInt(a,10)}d(xe,"parseBase10");var A=class extends T{constructor(e,t){super();this.stages={};this.commitLog=[];this.configureOptions=d((e={})=>{"adaptiveBinaryIndices"in e&&(this.adaptiveBinaryIndices=e.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},"configureOptions");this.count=d(e=>e?this.chain().find(e).filteredrows.length:this.data.length,"count");this.startTransaction=d(()=>{if(this.transactional){this.cachedData=I(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(let e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].startTransaction()}},"startTransaction");this.commit=d(()=>{if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(let e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].commit()}},"commit");this.rollback=d(()=>{if(this.transactional){this.cachedData!==null&&this.cachedIndex!==null&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(let e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].rollback()}},"rollback");this.mapReduce=d((e,t)=>t(this.data.map(e)),"mapReduce");this.lokiConsoleWrapper={log(e){},warn(e){},error(e){}};this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;let i=this;t=t||{},t.unique&&(Array.isArray(t.unique)||(t.unique=[t.unique]),t.unique.forEach(h=>{i.uniqueNames.push(h)})),t.exact&&t.exact.forEach(h=>{i.constraints.exact[h]=new Y(h)}),this.adaptiveBinaryIndices=Object.hasOwn(t,"adaptiveBinaryIndices")?t.adaptiveBinaryIndices:!0,this.transactional=Object.hasOwn(t,"transactional")?t.transactional:!1,this.cloneObjects=Object.hasOwn(t,"clone")?t.clone:!1,this.cloneMethod=Object.hasOwn(t,"cloneMethod")?t.cloneMethod:"parse-stringify",this.asyncListeners=Object.hasOwn(t,"asyncListeners")?t.asyncListeners:!1,this.disableMeta=Object.hasOwn(t,"disableMeta")?t.disableMeta:!1,this.disableChangesApi=Object.hasOwn(t,"disableChangesApi")?t.disableChangesApi:!0,this.disableDeltaChangesApi=Object.hasOwn(t,"disableDeltaChangesApi")?t.disableDeltaChangesApi:!0,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=Object.hasOwn(t,"autoupdate")?t.autoupdate:!1,this.serializableIndices=Object.hasOwn(t,"serializableIndices")?t.serializableIndices:!0,this.disableFreeze=Object.hasOwn(t,"disableFreeze")?t.disableFreeze:!0,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(t.ttl||-1,t.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[];let n=[];if(t&&t.indices)if(Object.prototype.toString.call(t.indices)==="[object Array]")n=t.indices;else if(typeof t.indices=="string")n=[t.indices];else throw new TypeError("Indices needs to be a string or an array of strings");for(let h=0;h<n.length;h++)this.ensureIndex(n[h]);function s(h){let u=new Set;u.add||(u.add=function(p){return this.includes(p)||this.push(p),this}),h.forEach(({object:p})=>{u.add(p)}),u.forEach(p=>{if(!F.call(p,"$loki"))return i.removeAutoUpdateObserver(p);try{i.update(p)}catch(f){console.log(f)}})}d(s,"observerCallback"),this.observerCallback=s;function o(h,u){return u?l(u,h):JSON.parse(JSON.stringify(h))}d(o,"getChangeDelta"),this.getChangeDelta=o;function l(h,u){let p=u!==null&&typeof u=="object"?Object.keys(u):null;if(p&&p.length&&!["string","boolean","number"].includes(typeof u)){let f={};for(let g=0;g<p.length;g++){let y=p[g];if(y in u)if(!(y in h)||i.uniqueNames.includes(y)||y=="$loki"||y=="meta")f[y]=u[y];else{let O=l(h[y],u[y]);typeof O!="undefined"&&(f[y]=O)}}return Object.keys(f).length===0?void 0:f}else return h===u?void 0:u}d(l,"getObjectDelta"),this.getObjectDelta=l;function c(){i.changes=[]}d(c,"flushChanges"),this.getChanges=()=>i.changes,this.flushChanges=c,this.setChangesApi=h=>{i.disableChangesApi=!h,h||(i.disableDeltaChangesApi=!1)},this.on("delete",d(function(u){i.disableChangesApi||i.createChange(i.name,"R",u)},"deleteCallback")),this.on("warning",h=>{i.lokiConsoleWrapper.warn(h)}),c()}createChange(e,t,i,n){this.changes.push({name:e,operation:t,obj:t=="U"&&!this.disableDeltaChangesApi?this.getChangeDelta(i,n):JSON.parse(JSON.stringify(i))})}insertMeta(e){let t,i;if(!(this.disableMeta||!e)){if(Array.isArray(e)){for(t=e.length,i=0;i<t;i++)"meta"in e[i]||(e[i].meta={}),e[i].meta.created=new Date().getTime(),e[i].meta.revision=0;return}e.meta||(e.meta={}),e.meta.created=new Date().getTime(),e.meta.revision=0}}updateMeta(e){return this.disableMeta||!e||(this.disableFreeze||(e=B(e),e.meta=B(e.meta)),e.meta.updated=new Date().getTime(),e.meta.revision+=1),e}createInsertChange(e){this.createChange(this.name,"I",e)}createUpdateChange(e,t){this.createChange(this.name,"U",e,t)}insertMetaWithChange(e){this.insertMeta(e),this.createInsertChange(e)}updateMetaWithChange(e,t){return e=this.updateMeta(e),this.createUpdateChange(e,t),e}addAutoUpdateObserver(e){!this.autoupdate||typeof Object.observe!="function"||Object.observe(e,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])}removeAutoUpdateObserver(e){!this.autoupdate||typeof Object.observe!="function"||Object.unobserve(e,this.observerCallback)}addTransform(e,t){if(e in this.transforms)throw new Error("a transform by that name already exists");this.transforms[e]=t}getTransform(e){return this.transforms[e]}setTransform(e,t){this.transforms[e]=t}removeTransform(e){delete this.transforms[e]}byExample(e){let t,i,n=[];for(t in e)t in e&&n.push((i={},i[t]=e[t],i));return{$and:n}}findObject(e){return this.findOne(this.byExample(e))}findObjects(e){return this.find(this.byExample(e))}ttlDaemonFuncGen(){let e=this,t=this.ttl.age;return d(function(){let n=Date.now();e.chain().where(d(function(l){let c=l.meta.updated||l.meta.created,h=n-c;return t<h},"daemonFilter")).remove()},"ttlDaemon")}setTTL(e,t){e<0?clearInterval(this.ttl.daemon):(this.ttl.age=e,this.ttl.ttlInterval=t,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),t))}prepareFullDocIndex(){let e=this.data.length,t=new Array(e);for(let i=0;i<e;i+=1)t[i]=i;return t}ensureIndex(e,t){if(typeof t=="undefined"&&(t=!1),e==null)throw new Error("Attempting to set index without an associated property");if(this.binaryIndices[e]&&!t&&!this.binaryIndices[e].dirty||this.adaptiveBinaryIndices===!0&&e in this.binaryIndices&&!t)return;let i={name:e,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[e]=i;let n=((s,o)=>{let l,c,h=~s.indexOf(".")?s.split("."):!1;return(u,p)=>{if(h?(l=m.getIn(o[u],h,!0),c=m.getIn(o[p],h,!0)):(l=o[u][s],c=o[p][s]),l!==c){if(b.lt(l,c,!1))return-1;if(b.gt(l,c,!1))return 1}return 0}})(e,this.data);i.values.sort(n),i.dirty=!1,this.dirty=!0}checkAllIndexes(e){let t,i=this.binaryIndices,n=[],s;for(t in i)F.call(i,t)&&(s=this.checkIndex(t,e),s||n.push(t));return n}checkIndex(e,t={}){t.randomSamplingFactor&&t.randomSampling!==!1&&(t.randomSampling=!0),t.randomSamplingFactor=t.randomSamplingFactor||.1,(t.randomSamplingFactor<0||t.randomSamplingFactor>1)&&(t.randomSamplingFactor=.1);let i=!0,n,s,o;if(!(e in this.binaryIndices))throw new Error(`called checkIndex on property without an index: ${e}`);this.adaptiveBinaryIndices||this.ensureIndex(e);let l=this.binaryIndices[e].values,c=l.length;if(c!==this.data.length)return t.repair&&this.ensureIndex(e,!0),!1;if(c===0)return!0;let h=e.includes(".");if(c===1)i=l[0]===0;else if(t.randomSampling){if(S.$lte(m.getIn(this.data[l[0]],e,h),m.getIn(this.data[l[1]],e,h))||(i=!1),S.$lte(m.getIn(this.data[l[c-2]],e,h),m.getIn(this.data[l[c-1]],e,h))||(i=!1),i){for(s=Math.floor((c-1)*t.randomSamplingFactor),n=0;n<s-1;n++)if(o=Math.floor(Math.random()*(c-1)),!S.$lte(m.getIn(this.data[l[o]],e,h),m.getIn(this.data[l[o+1]],e,h))){i=!1;break}}}else for(n=0;n<c-1;n++)if(!S.$lte(m.getIn(this.data[l[n]],e,h),m.getIn(this.data[l[n+1]],e,h))){i=!1;break}return!i&&t.repair&&this.ensureIndex(e,!0),i}getBinaryIndexValues(e){let t,i=this.binaryIndices[e].values,n=[];for(t=0;t<i.length;t++)n.push(m.getIn(this.data[i[t]],e,!0));return n}getUniqueIndex(e,t){let i=this.constraints.unique[e];return!i&&t?this.ensureUniqueIndex(e):i}ensureUniqueIndex(e){let t=this.constraints.unique[e];return t||this.uniqueNames.includes(e)||this.uniqueNames.push(e),this.constraints.unique[e]=t=new H(e),this.data.forEach(i=>{t.set(i)}),t}ensureAllIndexes(e){let t=this.binaryIndices;for(let i in t)F.call(t,i)&&this.ensureIndex(i,e)}flagBinaryIndexesDirty(){let e=this.binaryIndices;for(let t in e)F.call(e,t)&&(e[t].dirty=!0)}flagBinaryIndexDirty(e){this.binaryIndices[e]&&(this.binaryIndices[e].dirty=!0)}ensureId(){if(this.idIndex)return;let e=this.data,t=0,i=e.length,n=new Array(i);for(t;t<i;t++)n[t]=e[t].$loki;this.idIndex=n}ensureIdAsync(e){this.async(function(){this.ensureId()},e)}addDynamicView(e,t){let i=new E(this,e,t);return this.DynamicViews.push(i),i}removeDynamicView(e){this.DynamicViews=this.DynamicViews.filter(t=>t.name!==e)}getDynamicView(e){for(let t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===e)return this.DynamicViews[t];return null}findAndUpdate(e,t){typeof e=="function"?this.updateWhere(e,t):this.chain().find(e).update(t)}findAndRemove(e){this.chain().find(e).remove()}insert(e,t){if(!Array.isArray(e))return this.insertOne(e);let i,n=[],s=t&&!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;s&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",e);for(let o=0,l=e.length;o<l;o++){if(i=this.insertOne(e[o],!0),!i)return;n.push(i)}}finally{s&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",n),n=this.cloneObjects?I(n,this.cloneMethod):n,n.length===1?n[0]:n}insertOne(e,t){let i=null;if(typeof e!="object"?i=new TypeError("Document needs to be an object"):e===null&&(i=new TypeError("Object cannot be null")),i!==null)throw this.emit("error",i),i;let n=this.cloneObjects?I(e,this.cloneMethod):e;if(this.disableFreeze||(n=B(n)),this.disableMeta||(typeof n.meta=="undefined"?n.meta={revision:0,created:0}:this.disableFreeze||(n.meta=B(n.meta))),t||this.emit("pre-insert",n),!this.add(n))return;this.disableChangesApi?this.insertMeta(n):this.insertMetaWithChange(n),this.disableFreeze||C(n);let s=this.cloneObjects?I(n,this.cloneMethod):n;return t||this.emit("insert",s),this.addAutoUpdateObserver(s),s}clear(e){let t=this;e=e||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},e.removeIndices===!0?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach(n=>{t.binaryIndices[n].dirty=!1,t.binaryIndices[n].values=[]})}update(e){let t,i,n;if(Array.isArray(e)){n=e.length,t=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,t&&(this.adaptiveBinaryIndices=!1);try{for(i=0;i<n;i+=1)this.update(e[i])}finally{t&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return}if(!F.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();let s=this.get(e.$loki,!0),o,l=this;if(!s)throw new Error("Trying to update a document not in collection.");let c=s[0],h=s[1];o=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?I(e,this.cloneMethod):e,this.emit("pre-update",e),this.uniqueNames.forEach(f=>{l.getUniqueIndex(f,!0).update(c,o)}),this.data[h]=o,o!==e&&this.addAutoUpdateObserver(e);for(let f=0;f<this.DynamicViews.length;f++)this.DynamicViews[f].evaluateDocument(h,!1);let u;if(this.adaptiveBinaryIndices){let f=this.binaryIndices;for(u in f)this.adaptiveBinaryIndexUpdate(h,u)}else this.flagBinaryIndexesDirty();this.idIndex[h]=o.$loki,this.isIncremental&&this.dirtyIds.push(o.$loki),this.commit(),this.dirty=!0,this.disableChangesApi?o=this.updateMeta(o):o=this.updateMetaWithChange(o,c),this.disableFreeze||C(o);let p;return this.cloneObjects?p=I(o,this.cloneMethod):p=o,this.emit("update",p),p}catch(s){throw this.rollback(),this.lokiConsoleWrapper.error(s.message),this.emit("error",s),s}}add(e){if(typeof e!="object")throw new TypeError("Object being added needs to be an object");if(typeof e.$loki!="undefined")throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);let t=this.maxId;e.$loki=t,this.disableMeta||(e.meta.version=0);for(let s=0,o=this.uniqueNames.length;s<o;s++)this.getUniqueIndex(this.uniqueNames[s],!0).set(e);this.idIndex&&this.idIndex.push(t),this.isIncremental&&this.dirtyIds.push(t),this.data.push(e);let i=this.data.length-1,n=this.DynamicViews.length;for(let s=0;s<n;s++)this.DynamicViews[s].evaluateDocument(i,!0);if(this.adaptiveBinaryIndices){let s=this.binaryIndices;for(let o in s)this.adaptiveBinaryIndexInsert(i,o)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?I(e,this.cloneMethod):e}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}}updateWhere(e,t){let i=this.where(e),n=0,s;try{for(n;n<i.length;n++)s=t(i[n]),this.update(s)}catch(o){this.rollback(),this.lokiConsoleWrapper.error(o.message)}}removeWhere(e){let t;typeof e=="function"?(t=this.data.filter(e),this.remove(t)):this.chain().find(e).remove()}removeDataOnly(){this.remove(this.data.slice())}removeBatchByPositions(e){let t=e.length,i={},n,s,o,l=Object.keys(this.binaryIndices).length,c=Object.keys(this.constraints.unique).length,h=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,u,p=this;try{for(this.startTransaction(),this.ensureId(),o=0;o<t;o++)i[this.idIndex[e[o]]]=!0;if(n=this.DynamicViews.length,n>0||l>0||c>0){if(n>0)for(s=0;s<n;s++)this.DynamicViews[s].removeDocument(e);if(this.adaptiveBinaryIndices&&!h){let f,g=this.binaryIndices;for(f in g)this.adaptiveBinaryIndexRemove(e,f)}else this.flagBinaryIndexesDirty();c&&this.uniqueNames.forEach(f=>{let g=p.getUniqueIndex(f);if(g)for(o=0;o<t;o++)u=p.data[e[o]],u[f]!==null&&u[f]!==void 0&&g.remove(u[f])})}if(!this.disableChangesApi||this.events.delete.length>1)for(o=0;o<t;o++)this.emit("delete",this.data[e[o]]);if(this.data=this.data.filter(({$loki:f})=>!i[f]),this.isIncremental)for(o=0;o<t;o++)this.dirtyIds.push(this.idIndex[e[o]]);this.idIndex=this.idIndex.filter(f=>!i[f]),this.adaptiveBinaryIndices&&h&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(f){return this.rollback(),h&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(f.message),this.emit("error",f),null}}removeBatch(e){let t=e.length,i=this.data.length,n,s={},o=[];for(n=0;n<i;n++)s[this.data[n].$loki]=n;for(n=0;n<t;n++)typeof e[n]=="object"?o.push(s[e[n].$loki]):o.push(s[e[n]]);this.removeBatchByPositions(o)}remove(e){let t;if(typeof e=="number"?t=this.get(e):t=e,typeof t!="object")throw new Error("Parameter is not an object");if(Array.isArray(t)){this.removeBatch(t);return}if(!F.call(t,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();let i=this.get(t.$loki,!0),n=i[1],s=this;this.uniqueNames.forEach(o=>{if(t[o]!==null&&typeof t[o]!="undefined"){let l=s.getUniqueIndex(o);l&&l.remove(t[o])}});for(let o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(n);if(this.adaptiveBinaryIndices){let o,l=this.binaryIndices;for(o in l)this.adaptiveBinaryIndexRemove(n,o)}else this.flagBinaryIndexesDirty();return this.data.splice(n,1),this.removeAutoUpdateObserver(t),this.idIndex.splice(n,1),this.isIncremental&&this.dirtyIds.push(t.$loki),this.commit(),this.dirty=!0,this.emit("delete",i[0]),this.disableFreeze||(t=B(t)),delete t.$loki,delete t.meta,this.disableFreeze||N(t),t}catch(i){return this.rollback(),this.lokiConsoleWrapper.error(i.message),this.emit("error",i),null}}get(e,t){this.idIndex||this.ensureId();let i=t||!1,n=this.idIndex,s=n.length-1,o=0,l=o+s>>1;if(e=typeof e=="number"?e:parseInt(e,10),isNaN(e))throw new TypeError("Passed id is not an integer");for(;n[o]<n[s];)l=o+s>>1,n[l]<e?o=l+1:s=l;return s===o&&n[o]===e?i?[this.data[o],o]:this.data[o]:null}getBinaryIndexPosition(e,t){let i=m.getIn(this.data[e],t,!0),n=this.binaryIndices[t].values,s=this.calculateRange("$eq",t,i);if(s[0]===0&&s[1]===-1)return null;let o=s[0],l=s[1];for(let c=o;c<=l;c++)if(n[c]===e)return c;return null}adaptiveBinaryIndexInsert(e,t){let i=t.includes("."),n=this.binaryIndices[t].values,s=m.getIn(this.data[e],t,i);this.serializableIndices===!0&&s instanceof Date&&(this.data[e][t]=s.getTime(),s=m.getIn(this.data[e],t));let o=n.length===0?0:this.calculateRangeStart(t,s,!0,i);this.binaryIndices[t].values.splice(o,0,e)}adaptiveBinaryIndexUpdate(e,t){let i,n=this.binaryIndices[t].values,s=n.length;for(i=0;i<s&&n[i]!==e;i++);this.binaryIndices[t].values.splice(i,1),this.adaptiveBinaryIndexInsert(e,t)}adaptiveBinaryIndexRemove(e,t,i){let n=this.binaryIndices[t],s,o,l,c,h={},u,p;if(Array.isArray(e))if(c=e.length,c===1)e=e[0];else{for(l=0;l<c;l++)h[e[l]]=!0;if(n.values=n.values.filter(y=>!h[y]),i===!0)return;let g=e.slice();for(g.sort((y,O)=>y-O),s=n.values.length,o=0;o<s;o++){for(u=n.values[o],p=0,l=0;l<c&&u>g[l];l++)p++;n.values[o]-=p}return}let f=this.getBinaryIndexPosition(e,t);if(f===null)return null;if(n.values.splice(f,1),i!==!0)for(s=n.values.length,o=0;o<s;o++)n.values[o]>e&&n.values[o]--}calculateRangeStart(e,t,i,n){let s=this.data,o=this.binaryIndices[e].values,l=0,c=o.length-1,h=0;if(o.length===0)return-1;for(;l<c;)h=l+c>>1,b.lt(m.getIn(s[o[h]],e,n),t,!1)?l=h+1:c=h;let u=l;return b.aeq(t,m.getIn(s[o[u]],e,n))?u:b.lt(t,m.getIn(s[o[u]],e,n),!1)?i?u:u-1:i?u+1:u}calculateRangeEnd(e,t,i){let n=this.data,s=this.binaryIndices[e].values,o=0,l=s.length-1,c=0;if(s.length===0)return-1;for(;o<l;)c=o+l>>1,b.lt(t,m.getIn(n[s[c]],e,i),!1)?l=c:o=c+1;let h=l;return b.aeq(t,m.getIn(n[s[h]],e,i))?h:b.gt(t,m.getIn(n[s[h]],e,i),!1)?h+1:b.aeq(t,m.getIn(n[s[h-1]],e,i))?h-1:h}calculateRange(e,t,i){let n=this.data,s=this.binaryIndices[t].values,o=0,l=s.length-1,c,h,u,p;if(n.length===0)return[0,-1];let f=t.includes("."),g=m.getIn(n[s[o]],t,f),y=m.getIn(n[s[l]],t,f);switch(e){case"$eq":case"$aeq":if(b.lt(i,g,!1)||b.gt(i,y,!1))return[0,-1];break;case"$dteq":if(b.lt(i,g,!1)||b.gt(i,y,!1))return[0,-1];break;case"$gt":if(b.gt(i,y,!0))return[0,-1];if(b.gt(g,i,!1))return[o,l];break;case"$gte":if(b.gt(i,y,!1))return[0,-1];if(b.gt(g,i,!0))return[o,l];break;case"$lt":if(b.lt(i,g,!0))return[0,-1];if(b.lt(y,i,!1))return[o,l];break;case"$lte":if(b.lt(i,g,!1))return[0,-1];if(b.lt(y,i,!0))return[o,l];break;case"$between":return b.gt(i[0],y,!1)?[0,-1]:b.lt(i[1],g,!1)?[0,-1]:(c=this.calculateRangeStart(t,i[0],!1,f),u=this.calculateRangeEnd(t,i[1],f),c<0&&c++,u>l&&u--,b.gt(m.getIn(n[s[c]],t,f),i[0],!0)||c++,b.lt(m.getIn(n[s[u]],t,f),i[1],!0)||u--,u<c?[0,-1]:[c,u]);case"$in":{let O=[],k=[];for(let R=0,w=i.length;R<w;R++){let $=this.calculateRange("$eq",t,i[R]);for(let M=$[0];M<=$[1];M++)O[M]===void 0&&(O[M]=!0,k.push(M))}return k}}switch(e){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":c=this.calculateRangeStart(t,i,!1,f),h=m.getIn(n[s[c]],t,f);break;default:break}switch(e){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":u=this.calculateRangeEnd(t,i,f),p=m.getIn(n[s[u]],t,f);break;default:break}switch(e){case"$eq":case"$aeq":case"$dteq":return b.aeq(h,i)?[c,u]:[0,-1];case"$gt":return b.aeq(m.getIn(n[s[u]],t,f),i)?[u+1,l]:[u,l];case"$gte":return b.aeq(m.getIn(n[s[c]],t,f),i)?[c,l]:[c+1,l];case"$lt":return b.aeq(m.getIn(n[s[c]],t,f),i)?[o,c-1]:[o,c];case"$lte":return b.aeq(m.getIn(n[s[u]],t,f),i)?[o,u]:[o,u-1];default:return[0,n.length-1]}}by(e,t){let i;if(t===void 0)return i=this,s=>i.by(e,s);let n=this.getUniqueIndex(e,!0).get(t);return this.cloneObjects?I(n,this.cloneMethod):n}findOne(e={}){let t=this.chain().find(e,!0).data();return Array.isArray(t)&&t.length===0?null:this.cloneObjects?I(t[0],this.cloneMethod):t[0]}chain(e,t){let i=new x(this);return typeof e=="undefined"?i:i.transform(e,t)}find(e){return this.chain().find(e).data()}findOneUnindexed(e,t){let i=this.data.length,n;for(;i--;)if(m.getIn(this.data[i],e,!0)===t)return n=this.data[i],n;return null}async(e,t){setTimeout(()=>{if(typeof e=="function")e(),t();else throw new TypeError("Argument passed for async execution is not a function")},0)}where(e){return this.chain().where(e).data()}eqJoin(e,t,i,n,s){return new x(this).eqJoin(e,t,i,n,s)}getStage(e){return this.stages[e]||(this.stages[e]={}),this.stages[e]}stage(e,t){let i=JSON.parse(JSON.stringify(t));return this.getStage(e)[t.$loki]=i,i}commitStage(e,t){let i=this.getStage(e),n,s=new Date().getTime();for(n in i)this.update(i[n]),this.commitLog.push({timestamp:s,message:t,data:JSON.parse(JSON.stringify(i[n]))});this.stages[e]={}}extract(e){let t=0,i=this.data.length,n=ee(e),s=[];for(t;t<i;t+=1)s.push(q(this.data[t],e,n));return s}max(e){return Math.max.apply(null,this.extract(e))}min(e){return Math.min.apply(null,this.extract(e))}maxRecord(e){let t=0,i=this.data.length,n=ee(e),s={index:0,value:void 0},o;for(t;t<i;t+=1)o!==void 0?o<q(this.data[t],e,n)&&(o=q(this.data[t],e,n),s.index=this.data[t].$loki):(o=q(this.data[t],e,n),s.index=this.data[t].$loki);return s.value=o,s}minRecord(e){let t=0,i=this.data.length,n=ee(e),s={index:0,value:void 0},o;for(t;t<i;t+=1)o!==void 0?o>q(this.data[t],e,n)&&(o=q(this.data[t],e,n),s.index=this.data[t].$loki):(o=q(this.data[t],e,n),s.index=this.data[t].$loki);return s.value=o,s}extractNumerical(e){return this.extract(e).map(xe).filter(Number).filter(t=>!isNaN(t))}avg(e){return Z(this.extractNumerical(e))}stdDev(e){return we(this.extractNumerical(e))}mode(e){let t={};this.extract(e).forEach(l=>{t[l]?t[l]+=1:t[l]=1});let n,s,o;for(s in t)n?n<t[s]&&(o=s):(o=s,n=t[s]);return o}median(e){let t=this.extractNumerical(e);t.sort(ve);let i=Math.floor(t.length/2);return t.length%2?t[i]:(t[i-1]+t[i])/2}};d(A,"Collection");function ue(a,r,e){for(var t=0,i=a.length,n,s;t<i;){if(s=t+i>>1,n=e.apply(null,[r,a[s]]),n===0)return{found:!0,index:s};n<0?i=s:t=s+1}return{found:!1,index:i}}d(ue,"binarySearch");function de(a){return function(r,e){return ue(r,e,a)}}d(de,"BSonSort");function fe(){}d(fe,"KeyValueStore");fe.prototype={keys:[],values:[],sort(a,r){return a<r?-1:a>r?1:0},setSort(a){this.bs=de(a)},bs(){return de(this.sort)},set(a,r){let e=this.bs(this.keys,a);e.found?this.values[e.index]=r:(this.keys.splice(e.index,0,a),this.values.splice(e.index,0,r))},get(a){return this.values[ue(this.keys,a,this.sort).index]}};function ie(){try{return window&&window.localStorage!==void 0&&window.localStorage!==null}catch(a){return!1}}d(ie,"localStorageAvailable");var _=class{exportDatabase(r,e,t){throw new Error("Method not implemented.")}loadDatabase(r,e){ie()?e(localStorage.getItem(r)):e(new Error("localStorage is not available"))}saveDatabase(r,e,t){ie()?(localStorage.setItem(r,e),t(null)):t(new Error("localStorage is not available"))}deleteDatabase(r,e){ie()?(localStorage.removeItem(r),e(null)):e(new Error("localStorage is not available"))}};d(_,"LocalStorageAdapter");var Q=class{constructor(r){this.hashStore={},this.options=r||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}exportDatabase(r,e,t){throw new Error("Method not implemented.")}loadDatabase(r,e){let t=this;this.options.asyncResponses?setTimeout(()=>{t.hashStore.hasOwnProperty(r)?e(t.hashStore[r].value):e(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(r)?e(this.hashStore[r].value):e(null)}saveDatabase(r,e,t){let i=this,n;this.options.asyncResponses?setTimeout(()=>{n=i.hashStore.hasOwnProperty(r)?i.hashStore[r].savecount:0,i.hashStore[r]={savecount:n+1,lastsave:new Date,value:e},t()},this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(r)?this.hashStore[r].savecount:0,this.hashStore[r]={savecount:n+1,lastsave:new Date,value:e},t())}deleteDatabase(r,e){this.hashStore.hasOwnProperty(r)&&delete this.hashStore[r],typeof e=="function"&&e()}};d(Q,"MemoryAdapter");function V(a,r){if(this.mode="reference",this.adapter=null,this.options=r||{},this.dbref=null,this.dbname="",this.pageIterator={},a){if(a.mode==="reference")throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=a}else throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=25*1024*1024),this.options.hasOwnProperty("delimiter")||(this.options.delimiter=`$<
`)}d(V,"PartitioningAdapter");V.prototype.loadDatabase=function(a,r){var e=this;this.dbname=a,this.dbref=new v(a),this.adapter.loadDatabase(a,function(t){if(!t){r(t);return}typeof t!="string"&&r(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var i=JSON.parse(t);if(e.dbref.loadJSONObject(i),i=null,e.dbref.collections.length===0){r(e.dbref);return}e.pageIterator={collection:0,pageIndex:0},e.loadNextPartition(0,function(){r(e.dbref)})})};V.prototype.loadNextPartition=function(a,r){var e=this.dbname+"."+a,t=this;if(this.options.paging===!0){this.pageIterator.pageIndex=0,this.loadNextPage(r);return}this.adapter.loadDatabase(e,function(i){var n=t.dbref.deserializeCollection(i,{delimited:!0,collectionIndex:a});t.dbref.collections[a].data=n,++a<t.dbref.collections.length?t.loadNextPartition(a,r):r()})};V.prototype.loadNextPage=function(a){var r=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,e=this;this.adapter.loadDatabase(r,function(t){var i=t.split(e.options.delimiter);t="";var n=i.length,s,o=i[n-1]==="";for(o&&(i.pop(),n=i.length,i[n-1]===""&&n===1&&(i.pop(),n=i.length)),s=0;s<n;s++)e.dbref.collections[e.pageIterator.collection].data.push(JSON.parse(i[s])),i[s]=null;i=[],o?++e.pageIterator.collection<e.dbref.collections.length?e.loadNextPartition(e.pageIterator.collection,a):a():(e.pageIterator.pageIndex++,e.loadNextPage(a))})};V.prototype.exportDatabase=function(a,r,e){var t,i=r.collections.length;for(this.dbref=r,this.dbname=a,this.dirtyPartitions=[-1],t=0;t<i;t++)r.collections[t].dirty&&this.dirtyPartitions.push(t);this.saveNextPartition(function(n){e(n)})};V.prototype.saveNextPartition=function(a){var r=this,e=this.dirtyPartitions.shift(),t=this.dbname+(e===-1?"":"."+e);if(this.options.paging&&e!==-1){this.pageIterator={collection:e,docIndex:0,pageIndex:0},this.saveNextPage(function(n){r.dirtyPartitions.length===0?a(n):r.saveNextPartition(a)});return}var i=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:e});this.adapter.saveDatabase(t,i,function(n){if(n){a(n);return}r.dirtyPartitions.length===0?a(null):r.saveNextPartition(a)})};V.prototype.saveNextPage=function(a){var r=this,e=this.dbref.collections[this.pageIterator.collection],t=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=0,n=e.data.length,s=this.options.delimiter.length,o="",l="",c=!1,h=!1,u=d(function(f){l="",f&&a(f),c?a(null):(r.pageIterator.pageIndex++,r.saveNextPage(a))},"pageSaveCallback");e.data.length===0&&(c=!0);let p=!1;for(;!p;)c||(o=JSON.stringify(e.data[this.pageIterator.docIndex]),l+=o,i+=o.length,++this.pageIterator.docIndex>=n&&(c=!0)),i>=this.options.pageSize&&(h=!0),(!h||c)&&(l+=this.options.delimiter,i+=s),(c||h)&&(this.adapter.saveDatabase(t,l,u),p=!0)};var v=class extends T{constructor(e,t){super();this.filename=e||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=t&&Object.hasOwn(t,"verbose")?t.verbose:!1,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};let i=d(()=>typeof global!="undefined"&&(global.android||global.NSObject)?"NATIVESCRIPT":typeof window=="undefined"||typeof global!="undefined"&&global.window&&typeof process!="undefined"?"NODEJS":typeof document!="undefined"?!document.URL.includes("http://")&&!document.URL.includes("https://")?"CORDOVA":"BROWSER":"CORDOVA","getENV");t&&Object.hasOwn(t,"env")?this.ENV=t.env:this.ENV=i(),this.ENV==="undefined"&&(this.ENV="NODEJS"),this.configureOptions(t,!0),this.on("init",this.clearChanges)}getIndexedAdapter(){let e;return typeof re=="function"&&(e=(Ce(),$e(je))),e}configureOptions(e,t){let i={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"},n={fs:U,localStorage:_,memory:Q};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,typeof e!="undefined"){if(this.options=e,Object.hasOwn(this.options,"persistenceMethod")&&typeof n[e.persistenceMethod]=="function"&&(this.persistenceMethod=e.persistenceMethod,this.persistenceAdapter=new n[e.persistenceMethod]),Object.hasOwn(this.options,"adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=e.adapter,this.options.adapter=null,this.isIncremental=this.persistenceAdapter.mode==="incremental"),e.autoload&&t){let s=this;setTimeout(()=>{s.loadDatabase(e,e.autoloadCallback)},1)}Object.hasOwn(this.options,"autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),Object.hasOwn(this.options,"autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,Object.hasOwn(this.options,"autosaveCallback")?this.autosaveEnable(e,e.autosaveCallback):this.autosaveEnable()),Object.hasOwn(this.options,"throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}Object.hasOwn(this.options,"serializationMethod")||(this.options.serializationMethod="normal"),Object.hasOwn(this.options,"destructureDelimiter")||(this.options.destructureDelimiter=`$<
`),this.persistenceAdapter===null&&(this.persistenceMethod=i[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new n[this.persistenceMethod]))}copy(e){let t=new v(this.filename,{env:"NA"}),i,n;if(e=e||{},t.loadJSONObject(this,{retainDirtyFlags:!0}),e.hasOwnProperty("removeNonSerializable")&&e.removeNonSerializable===!0)for(t.autosaveHandle=null,t.persistenceAdapter=null,i=t.collections.length,n=0;n<i;n++)t.collections[n].constraints=null,t.collections[n].ttl=null;return t}addCollection(e,t){let i,n=this.collections.length;if(t&&t.disableMeta===!0){if(t.disableChangesApi===!1)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(t.disableDeltaChangesApi===!1)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if(typeof t.ttl=="number"&&t.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(i=0;i<n;i+=1)if(this.collections[i].name===e)return this.collections[i];let s=new A(e,t);return s.isIncremental=this.isIncremental,this.collections.push(s),this.verbose&&(s.lokiConsoleWrapper=console),s}loadCollection(e){if(!e.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(e)}getCollection(e){let t,i=this.collections.length;for(t=0;t<i;t+=1)if(this.collections[t].name===e)return this.collections[t];return this.emit("warning",`collection ${e} not found`),null}renameCollection(e,t){let i=this.getCollection(e);return i&&(i.name=t),i}listCollections(){let e=this.collections.length,t=[];for(;e--;)t.push({name:this.collections[e].name,type:this.collections[e].objType,count:this.collections[e].data.length});return t}removeCollection(e){let t,i=this.collections.length;for(t=0;t<i;t+=1)if(this.collections[t].name===e){let n=new A(e,{}),s=this.collections[t];for(let o in s)s.hasOwnProperty(o)&&n.hasOwnProperty(o)&&(s[o]=n[o]);this.collections.splice(t,1);return}}getName(){return this.name}serializeReplacer(e,t){switch(e){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;case"lokiConsoleWrapper":return null;default:return t}}serialize(e={}){switch(e.hasOwnProperty("serializationMethod")||(e.serializationMethod=this.options.serializationMethod),e.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}}serializeDestructured(e){let t,i,n,s,o=[],l;if(e=e||{},e.hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned===!0&&e.hasOwnProperty("partition")&&e.partition>=0)return this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:e.partition});for(l=new v(this.filename),l.loadJSONObject(this),t=0;t<l.collections.length;t++)l.collections[t].data=[];if(e.partitioned===!0&&e.partition===-1)return l.serialize({serializationMethod:"normal"});for(o.push(l.serialize({serializationMethod:"normal"})),l=null,t=0;t<this.collections.length;t++)if(n=this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:t}),e.partitioned===!1&&e.delimited===!1){if(!Array.isArray(n))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(s=n.length,i=0;i<s;i++)o.push(n[i]),n[i]=null;o.push("")}else o.push(n);return e.partitioned?(e.delimited,o):e.delimited?(o.push(""),o.join(e.delimiter)):(o.push(""),o)}serializeCollection(e){let t,i=[];if(e=e||{},e.hasOwnProperty("delimited")||(e.delimited=!0),!e.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");let n=this.collections[e.collectionIndex].data.length;for(i=[],t=0;t<n;t++)i.push(JSON.stringify(this.collections[e.collectionIndex].data[t]));return e.delimited?(i.push(""),i.join(e.delimiter)):i}deserializeDestructured(e,t){let i=[],n,s,o=0,l,c=1,h=!1,u,p;if(t=t||{},t.hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.partitioned){if(t.hasOwnProperty("partition"))return t.partition===-1?(s=JSON.parse(e[0]),s):this.deserializeCollection(e[t.partition+1],t);for(s=JSON.parse(e[0]),l=s.collections.length,o=0;o<l;o++)s.collections[o].data=this.deserializeCollection(e[o+1],t);return s}if(t.delimited){if(i=e.split(t.delimiter),e=null,n=i.length,n===0)return null}else i=e;for(s=JSON.parse(i[0]),l=s.collections.length,i[0]=null;!h;)u=i[c],i[c]===""?++o>l&&(h=!0):(p=JSON.parse(i[c]),s.collections[o].data.push(p)),i[c++]=null;return s}deserializeCollection(e,t){let i=[],n;t=t||{},t.hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.delimited?(i=e.split(t.delimiter),i.pop()):i=e;let s=i.length;for(n=0;n<s;n++)i[n]=JSON.parse(i[n]);return i}loadJSON(e,t){let i;if(e.length===0)i={};else switch(this.options.serializationMethod){case"normal":case"pretty":i=JSON.parse(e);break;case"destructured":i=this.deserializeDestructured(e);break;default:i=JSON.parse(e);break}this.loadJSONObject(i,t)}loadJSONObject(e,t){let i=0,n=e.collections?e.collections.length:0,s,o,l,c,h,u;this.name=e.name,e.hasOwnProperty("throttledSaves")&&t&&!t.hasOwnProperty("throttledSaves")&&(this.throttledSaves=e.throttledSaves),this.collections=[];function p({name:f}){let g=t[f],y;return g.proto?(y=g.inflate||m.copyProperties,O=>{let k=new g.proto;return y(O,k),k}):g.inflate}for(d(p,"makeLoader"),i;i<n;i+=1){if(s=e.collections[i],o=this.addCollection(s.name,{disableChangesApi:s.disableChangesApi,disableDeltaChangesApi:s.disableDeltaChangesApi,disableMeta:s.disableMeta,disableFreeze:s.hasOwnProperty("disableFreeze")?s.disableFreeze:!0}),o.adaptiveBinaryIndices=s.hasOwnProperty("adaptiveBinaryIndices")?s.adaptiveBinaryIndices===!0:!1,o.transactional=s.transactional,o.asyncListeners=s.asyncListeners,o.cloneObjects=s.cloneObjects,o.cloneMethod=s.cloneMethod||"parse-stringify",o.autoupdate=s.autoupdate,o.changes=s.changes,o.dirtyIds=s.dirtyIds||[],t&&t.retainDirtyFlags===!0?o.dirty=s.dirty:o.dirty=!1,s.getData){if(t&&t.hasOwnProperty(s.name)||!o.disableFreeze||o.autoupdate)throw new Error(`this collection cannot be loaded lazily: ${s.name}`);o.getData=s.getData,Object.defineProperty(o,"data",{get(){let f=this.getData();return this.getData=null,Object.defineProperty(this,"data",{value:f}),f}})}else if(l=s.data.length,c=0,t&&t.hasOwnProperty(s.name))for(h=p(s),c;c<l;c++)u=h(s.data[c]),o.data[c]=u,o.addAutoUpdateObserver(u),o.disableFreeze||C(o.data[c]);else for(c;c<l;c++)o.data[c]=s.data[c],o.addAutoUpdateObserver(o.data[c]),o.disableFreeze||C(o.data[c]);if(o.maxId=typeof s.maxId=="undefined"?0:s.maxId,typeof s.binaryIndices!="undefined"&&(o.binaryIndices=s.binaryIndices),typeof s.transforms!="undefined"&&(o.transforms=s.transforms),o.uniqueNames=[],s.hasOwnProperty("uniqueNames")&&(o.uniqueNames=s.uniqueNames),typeof s.DynamicViews!="undefined"){for(let f=0;f<s.DynamicViews.length;f++){let g=s.DynamicViews[f],y=o.addDynamicView(g.name,g.options);y.resultdata=g.resultdata,y.resultsdirty=g.resultsdirty,y.filterPipeline=g.filterPipeline,y.sortCriteriaSimple=g.sortCriteriaSimple,y.sortCriteria=g.sortCriteria,y.sortFunction=null,y.sortDirty=g.sortDirty,o.disableFreeze||(C(y.filterPipeline),y.sortCriteriaSimple?C(y.sortCriteriaSimple):y.sortCriteria&&C(y.sortCriteria)),y.resultset.filteredrows=g.resultset.filteredrows,y.resultset.filterInitialized=g.resultset.filterInitialized,y.rematerialize({removeWhereFilters:!0})}e.databaseVersion<1.5&&(o.ensureAllIndexes(!0),o.dirty=!0)}}}close(e){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(e),e=void 0)),e&&this.on("close",e),this.emit("close")}generateChangesNotification(e){function t({name:s}){return s}d(t,"getCollName");let i=[],n=e||this.collections.map(t);return this.collections.forEach(s=>{n.includes(t(s))&&(i=i.concat(s.getChanges()))}),i}serializeChanges(e){return JSON.stringify(this.generateChangesNotification(e))}deserializeChanges(e){return JSON.parse(e)}clearChanges(){this.collections.forEach(e=>{e.flushChanges&&e.flushChanges()})}throttledSaveDrain(e,t){let i=this,n=new Date().getTime();if(this.throttledSaves||e(!0),t=t||{},t.hasOwnProperty("recursiveWait")||(t.recursiveWait=!0),t.hasOwnProperty("recursiveWaitLimit")||(t.recursiveWaitLimit=!1),t.hasOwnProperty("recursiveWaitLimitDuration")||(t.recursiveWaitLimitDuration=2e3),t.hasOwnProperty("started")||(t.started=new Date().getTime()),this.throttledSaves&&this.throttledSavePending)if(t.recursiveWait)this.throttledCallbacks.push(()=>{if(i.throttledSavePending){if(t.recursiveWaitLimit&&n-t.started>t.recursiveWaitLimitDuration){e(!1);return}i.throttledSaveDrain(e,t);return}else{e(!0);return}});else{this.throttledCallbacks.push(e);return}else e(!0)}loadDatabaseInternal(e,t){let i=t||(s=>{if(s)throw s}),n=this;this.persistenceAdapter!==null?this.persistenceAdapter.loadDatabase(this.filename,d(function(o){if(typeof o=="string"){let l=!1;try{n.loadJSON(o,e||{}),l=!0}catch(c){i(c)}l&&(i(null),n.emit("loaded",`database ${n.filename} loaded`))}else{if(!o){i(null),n.emit("loaded",`empty database ${n.filename} loaded`);return}if(o instanceof Error){i(o);return}if(typeof o=="object"){n.loadJSONObject(o,e||{}),i(null),n.emit("loaded",`database ${n.filename} loaded`);return}i(`unexpected adapter response : ${o}`)}},"loadDatabaseCallback")):i(new Error("persistenceAdapter not configured"))}loadDatabase(e,t){let i=this;if(!this.throttledSaves){this.loadDatabaseInternal(e,t);return}this.throttledSaveDrain(n=>{if(n){i.throttledSavePending=!0,i.loadDatabaseInternal(e,s=>{i.throttledCallbacks.length===0?i.throttledSavePending=!1:i.saveDatabase(),typeof t=="function"&&t(s)});return}else typeof t=="function"&&t(new Error("Unable to pause save throttling long enough to read database"))},e)}saveDatabaseInternal(e){let t=e||(n=>{if(n)throw n}),i=this;if(!this.persistenceAdapter){t(new Error("persistenceAdapter not configured"));return}if(this.persistenceAdapter.mode==="incremental"){let n;this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,d(function(){if(i.ignoreAutosave=!1,n){t(new Error("adapter error - getLokiCopy called more than once"));return}let o=i.copy({removeNonSerializable:!0});return n=i.collections.map(({dirty:l,dirtyIds:c})=>[l,c]),i.collections.forEach(l=>{l.dirty=!1,l.dirtyIds=[]}),o},"getLokiCopy"),d(function(o){i.ignoreAutosave=!1,o&&n&&i.collections.forEach((l,c)=>{let h=n[c];l.dirty=l.dirty||h[0],l.dirtyIds=l.dirtyIds.concat(h[1])}),t(o)},"exportDatabaseCallback"))}else this.persistenceAdapter.mode==="reference"&&typeof this.persistenceAdapter.exportDatabase=="function"?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),d(function(s){i.autosaveClearFlags(),t(s)},"exportDatabaseCallback")):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),d(function(s){t(s)},"saveDatabasecallback")))}saveDatabase(e){if(!this.throttledSaves){this.saveDatabaseInternal(e);return}if(this.throttledSavePending){this.throttledCallbacks.push(e);return}let t=this.throttledCallbacks;this.throttledCallbacks=[],t.unshift(e),this.throttledSavePending=!0;let i=this;this.saveDatabaseInternal(n=>{i.throttledSavePending=!1,t.forEach(s=>{typeof s=="function"&&setTimeout(()=>{s(n)},1)}),i.throttledCallbacks.length>0&&i.saveDatabase()})}saveDatabaseAsync(){return ge(this,null,function*(){return new Promise((e,t)=>{if(!this.throttledSaves){this.saveDatabaseInternal(e());return}if(this.throttledSavePending){this.throttledCallbacks.push(e());return}let i=this.throttledCallbacks;this.throttledCallbacks=[],i.unshift(e()),this.throttledSavePending=!0;let n=this;this.saveDatabaseInternal(s=>{s&&t(s),n.throttledSavePending=!1,i.forEach(o=>{typeof o=="function"&&setTimeout(()=>{o(s)},1)}),n.throttledCallbacks.length>0&&n.saveDatabase()})})})}deleteDatabase(e,t){let i=t||(n=>{if(n)throw n});typeof e=="function"&&!t&&(i=e),this.persistenceAdapter!==null?this.persistenceAdapter.deleteDatabase(this.filename,d(function(s){i(s)},"deleteDatabaseCallback")):i(new Error("persistenceAdapter not configured"))}autosaveDirty(){for(let e=0;e<this.collections.length;e++)if(this.collections[e].dirty)return!0;return!1}autosaveClearFlags(){for(let e=0;e<this.collections.length;e++)this.collections[e].dirty=!1}autosaveEnable(e,t){this.autosave=!0;let i=5e3,n=this;typeof this.autosaveInterval!="undefined"&&this.autosaveInterval!==null&&(i=this.autosaveInterval),this.autosaveHandle=setInterval(d(function(){n.autosaveDirty()&&!n.ignoreAutosave&&n.saveDatabase(t)},"autosaveHandleInterval"),i)}autosaveDisable(){typeof this.autosaveHandle!="undefined"&&this.autosaveHandle!==null&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)}};d(v,"Sylvie");v.prototype.toJson=v.prototype.serialize;v.prototype.save=v.prototype.saveDatabase;v.deepFreeze=C;v.freeze=N;v.unFreeze=B;v.LokiOps=S;v.Collection=A;v.DynamicView=E;v.Resultset=x;v.KeyValueStore=fe;v.LokiMemoryAdapter=Q;v.LokiPartitioningAdapter=V;v.LokiLocalStorageAdapter=_;v.LokiFsAdapter=U;v.persistenceAdapters={fs:U,localStorage:_};v.aeq=ae;v.lt=oe;v.gt=le;v.Comparators=b;var F=Object.prototype.hasOwnProperty;typeof window!="undefined"&&Object.assign(window,{loki:v,Sylvie:v});var Ki=v;export{Ki as default,F as hasOwnProperty};
//# sourceMappingURL=sylviejs.js.map
